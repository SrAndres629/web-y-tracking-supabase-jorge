# ğŸ” Diagrama de Arquitectura - Problemas de api/

## Flujo Actual (ProblemÃ¡tico)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VERCEL / SERVERLESS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        api/index.py (81 lÃ­neas)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. MANIPULACIÃ“N DE SYS.PATH (lÃ­neas 5-7) âš ï¸                â”‚   â”‚
â”‚  â”‚     sys.path.insert(0, parent_dir)  â† ANTI-PATRÃ“N           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. FORENSIC LOGGING (lÃ­neas 12-26) ğŸ“                      â”‚   â”‚
â”‚  â”‚     os.walk("/var/task")  â† EXPONE SISTEMA DE ARCHIVOS     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. TRY/EXCEPT BLOQUE (lÃ­neas 28-81)                         â”‚   â”‚
â”‚  â”‚     try:                                                     â”‚   â”‚
â”‚  â”‚        from main import app  â† IMPORT CRÃTICO               â”‚   â”‚
â”‚  â”‚     except:                                                  â”‚   â”‚
â”‚  â”‚        GENERAR HTML DE ERROR INLINE (53 lÃ­neas) ğŸ”´          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                       â”‚
              â–¼ SUCCESS                               â–¼ ERROR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      main.py (204 lÃ­neas)â”‚             â”‚  HTML ERROR PAGE GENERATED   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚  â€¢ Stack trace completo      â”‚
â”‚  â”‚ from app.routes     â”‚  â”‚             â”‚  â€¢ System info               â”‚
â”‚  â”‚ import pages        â”‚  â”‚             â”‚  â€¢ Diagnostics report        â”‚
â”‚  â”‚ import tracking...  â”‚  â”‚             â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚  âš ï¸ SECURITY RISK            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ from app.middleware â”‚  â”‚
â”‚  â”‚ import identity     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ from app.config     â”‚  â”‚
â”‚  â”‚ import settings     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         app/             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ routes/ (legacy)â”‚â—„â”€â”€â”€â”˜ â† main.py usa LEGACY
â”‚  â”‚ - pages.py      â”‚
â”‚  â”‚ - tracking_...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ interfaces/api/routes/  â”‚ â† UNUSED ğŸ”´
â”‚  â”‚ - pages.py (new)        â”‚
â”‚  â”‚ - tracking.py (new)     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Problemas de Conectividad

```
FLUJO IDEAL (Clean Architecture):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel â”‚â”€â”€â”€â”€â–¶â”‚  api/   â”‚â”€â”€â”€â”€â–¶â”‚   app/interfaces/   â”‚â”€â”€â”€â”€â–¶â”‚  app/   â”‚
â”‚         â”‚     â”‚ index.pyâ”‚     â”‚   api/routes/       â”‚     â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚                    â”‚                      â”‚
     â”‚               â”‚                    â”‚                      â”‚
     â–¼               â–¼                    â–¼                      â–¼
   Entry         Thin              Interface Adapters      Business
   Point         Wrapper           (Controllers)           Logic


FLUJO ACTUAL (ProblemÃ¡tico):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel â”‚â”€â”€â”€â”€â–¶â”‚  api/   â”‚â”€â”€â”€â”€â–¶â”‚  main.pyâ”‚â”€â”€â”€â”€â–¶â”‚app/routesâ”‚â”€â”€â”€â”€â–¶â”‚  app/   â”‚
â”‚         â”‚     â”‚ index.pyâ”‚     â”‚         â”‚     â”‚(legacy)  â”‚     â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”œâ”€â”€â”‚  api/templates/ (13 archivos HTML) ğŸ”´        â”‚
                     â”‚  â”‚  â€¢ DeberÃ­an estar en app/templates/          â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â””â”€â”€â”‚  Error handling inline (53 lÃ­neas HTML) ğŸ”´   â”‚
                        â”‚  â€¢ DeberÃ­a estar en app/middleware/          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CONEXIÃ“N DESACTUALIZADA:
main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                  â”‚
    â”œâ”€â”€â–¶ from app.routes import pages  (LEGACY) â—„â”€â”€â”€â”€â”€â”€â”¤
    â”œâ”€â”€â–¶ from app.routes import tracking_routes       â”‚
    â””â”€â”€â–¶ from app.routes import admin                 â”‚
                                                      â”‚
    (NO USA)                                          â”‚
    â”œâ”€â”€â–¶ from app.interfaces.api.routes import pages  â”‚
    â””â”€â”€â–¶ from app.interfaces.api.routes import tracking
                                                      â”‚
    âš ï¸ main.py usa la estructura antigua              â”‚
```

## AnÃ¡lisis de Variables y Estado

### Estado Global ProblemÃ¡tico

```python
# api/index.py - Variables de estado
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sys.path[0] = parent_dir  â† MODIFICA GLOBAL STATE âš ï¸      â”‚
â”‚                                                            â”‚
â”‚ logger = logging.getLogger("Forensics")                   â”‚
â”‚   â””â”€â–¶ Logger separado del sistema principal               â”‚
â”‚                                                            â”‚
â”‚ error_trace  â† Expone informaciÃ³n de stack               â”‚
â”‚ report       â† Puede contener datos sensibles            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Inconsistencias de ConfiguraciÃ³n

```
VERSIÃ“N:
â”œâ”€â”€ main.py:        version="2.0.0"
â”œâ”€â”€ static/:        "version": "3.0.0" (package.json)
â””â”€â”€ api/index.py:   (sin versiÃ³n)

LOGGING:
â”œâ”€â”€ main.py:        logger = logging.getLogger(__name__)
â””â”€â”€ api/index.py:   logger = logging.getLogger("Forensics")
                    â””â”€â–¶ Nombre diferente, no hereda config

TEMPLATES:
â”œâ”€â”€ api/templates/:  13 archivos HTML (ubicaciÃ³n incorrecta)
â””â”€â”€ app/templates/:  VacÃ­o o no existe (ubicaciÃ³n correcta)
```

## Impacto en Agentes de IA

### Anti-Patrones que Dificultan el Trabajo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANTI-PATRÃ“N: MÃºltiples Responsabilidades                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  api/index.py hace:                                             â”‚
â”‚    1. ManipulaciÃ³n de sys.path                                  â”‚
â”‚    2. Forensic logging                                          â”‚
â”‚    3. Import bootstrap                                          â”‚
â”‚    4. Error handling con HTML generation                        â”‚
â”‚                                                                 â”‚
â”‚  âœ… DEBERÃA HACER: Solo 1 cosa - Entry point                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANTI-PATRÃ“N: Acoplamiento Temporal                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  api/index.py depende de que main.py estÃ© disponible            â”‚
â”‚  en tiempo de importaciÃ³n.                                      â”‚
â”‚                                                                 â”‚
â”‚  Si main.py tiene un error de sintaxis:                         â”‚
â”‚    1. api/index.py catch el error                               â”‚
â”‚    2. Genera HTML de error inline                               â”‚
â”‚    3. Pero NO puede inicializar la app correctamente            â”‚
â”‚                                                                 â”‚
â”‚  âœ… DEBERÃA: Delegar todo el manejo de errores a app/           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANTI-PATRÃ“N: UbicaciÃ³n Incorrecta de Recursos                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Templates estÃ¡n en api/templates/                              â”‚
â”‚                                                                 â”‚
â”‚  Agentes de IA buscan templates en:                             â”‚
â”‚    1. app/templates/ (Clean Architecture)                       â”‚
â”‚    2. templates/ (MVC tradicional)                              â”‚
â”‚    3. (NO buscan en api/templates/)                             â”‚
â”‚                                                                 â”‚
â”‚  âœ… DEBERÃA ESTAR: app/templates/                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Recomendaciones de RefactorizaciÃ³n

### Paso 1: Mover Templates
```bash
# Antes
api/
â”œâ”€â”€ index.py
â””â”€â”€ templates/  â† 13 archivos HTML

# DespuÃ©s
api/
â””â”€â”€ index.py

app/
â””â”€â”€ templates/  â† 13 archivos HTML (movidos)
    â”œâ”€â”€ layouts/
    â”œâ”€â”€ components/
    â”œâ”€â”€ sections/
    â””â”€â”€ pages/
```

### Paso 2: Simplificar api/index.py
```python
# Antes (81 lÃ­neas)
import sys
import os
# ... manipulaciÃ³n de paths ...
# ... forensic logging ...
# ... try/except con 53 lÃ­neas de HTML ...

# DespuÃ©s (15 lÃ­neas)
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from main import app

# El manejo de errores deberÃ­a estar en:
# app/middleware/error_handler.py
```

### Paso 3: Actualizar main.py
```python
# Antes
from app.routes import pages  # Legacy

# DespuÃ©s
from app.interfaces.api.routes import pages  # Clean Architecture
```

## MÃ©tricas de Complejidad

```
Complejidad CiclomÃ¡tica por Archivo:
â”œâ”€â”€ api/index.py:        CC = 8 (Alta - mÃºltiples try/except, if)
â”œâ”€â”€ main.py:             CC = 12 (Alta - muchos imports condicionales)
â””â”€â”€ Ideal para agentes:  CC < 5

Acoplamiento Aferente/Eferente:
â”œâ”€â”€ api/index.py:        Efferent = 3 (main, app.diagnostics, logging)
â”‚                        Afferent = 0 (solo Vercel lo usa)
â”œâ”€â”€ main.py:             Efferent = 15+ (todo app/)
â”‚                        Afferent = 1 (api/index.py)
â””â”€â”€ Problema:            main.py es un "God Module"

LÃ­neas de CÃ³digo por Responsabilidad:
â”œâ”€â”€ api/index.py:
â”‚   â”œâ”€â”€ Bootstrap:       15 lÃ­neas (18%)
â”‚   â”œâ”€â”€ Logging:         15 lÃ­neas (18%)
â”‚   â”œâ”€â”€ Error handling:  53 lÃ­neas (65%) ğŸ”´
â”‚   â””â”€â”€ Total:           83 lÃ­neas
```

---

*Diagrama generado para anÃ¡lisis arquitectÃ³nico*
# âœ… UPDATE 2026-02-11
# `main.py` ya referencia `app.interfaces.api.routes`. El diagrama conserva legado histÃ³rico.

# ðŸ§ª Pytest Configuration - Strict Mode
# 
# Silicon Valley Standard: ConfiguraciÃ³n estricta para testing de alta calidad

[pytest]
# Async
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Warnings (controlled via filterwarnings below)
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    # Pero tratar estos como errores
    error::RuntimeWarning

# Descubrimiento
testpaths = 
    tests/unit
    tests/test_new_architecture
    tests/property_based
    tests/state_machine
    tests/contracts
    tests/concurrency
    tests/snapshot
    tests/fuzzing
    tests/00_architecture

python_files = 
    test_*.py
    *_test.py

python_classes = 
    Test*

python_functions = 
    test_*

# Cobertura
addopts = 
    # Strict mode: fallar si hay problemas
    --strict-markers
    --strict-config
    
    # Verbosidad
    -v
    
    # Colores
    --color=yes
    
    # Capturar logs
    --log-cli-level=INFO
    
    # Mostrar locals en fallos
    --showlocals
    
    # Durations
    --durations=10
    --durations-min=1.0

# Markers personalizados
markers =
    # Niveles de testing
    unit: Unit tests - fast, isolated, no IO
    integration: Integration tests - with infrastructure
    e2e: End-to-end tests
    
    # Propiedades
    slow: Tests that take > 1 second
    critical: Business-critical path tests
    
    # Tipos especiales
    property_based: Property-based tests (Hypothesis)
    state_machine: State machine tests
    contract: Contract tests (pre/post conditions)
    mutation: Mutation testing
    concurrency: Thread-safety and race condition tests
    snapshot: Snapshot regression tests
    fuzzing: Fuzzing tests (random inputs)
    security: Security-focused tests
    performance: Performance benchmarks
    
    # Arquitectura
    architecture: Architecture governance tests
    audit: Audit tests
    
    # Capas
    domain: Domain layer tests
    application: Application layer tests
    infrastructure: Infrastructure layer tests
    interface: Interface layer tests

# Logging
log_format = %(asctime)s - %(name)s - %(levelname)s - %(message)s
log_date_format = %Y-%m-%d %H:%M:%S

# Hypothesis profile is loaded via conftest.py, not pytest.ini
